class t{constructor(t){this.container=document.getElementById(t),this.dataContainer=null,this.jsonContainer=null,this.currentEvent=null,this.eventsByClass=new Map,this.globalJsonExpanded="true"===localStorage.getItem("dashboard-json-expanded"),this.keyboardListenerAdded=!1,this.init()}init(){this.setupContainers(),this.setupEventHandlers(),this.showEmptyState()}setupContainers(){this.dataContainer=document.getElementById("module-data-content"),this.jsonContainer=null,this.dataContainer||console.error("Module viewer data container not found")}setupEventHandlers(){document.addEventListener("eventSelected",t=>{this.showEventDetails(t.detail.event)}),document.addEventListener("eventSelectionCleared",()=>{this.showEmptyState()}),document.addEventListener("socketEventUpdate",t=>{this.updateEventsByClass(t.detail.events)})}showEmptyState(){this.dataContainer&&(this.dataContainer.innerHTML='\n                <div class="module-empty">\n                    <p>Click on an event to view structured data</p>\n                    <p class="module-hint">Data is organized by event type</p>\n                </div>\n            '),this.currentEvent=null}showEventDetails(t){this.currentEvent=t,this.renderStructuredData(t),this.renderJsonData(t)}renderStructuredData(t){if(!this.dataContainer)return;const e=this.createContextualHeader(t),n=this.createEventStructuredView(t),o=this.createCollapsibleJsonSection(t);this.dataContainer.innerHTML=e+n+o,this.initializeJsonToggle()}renderJsonData(t){}ingest(t){Array.isArray(t)?t.length>0?this.showEventDetails(t[0]):this.showEmptyState():t&&"object"==typeof t?this.showEventDetails(t):this.showEmptyState()}updateEventsByClass(t){this.eventsByClass.clear(),t.forEach(t=>{const e=this.getEventClass(t);this.eventsByClass.has(e)||this.eventsByClass.set(e,[]),this.eventsByClass.get(e).push(t)})}getEventClass(t){if(!t.type)return"unknown";switch(t.type){case"session":return"Session Management";case"claude":return"Claude Interactions";case"agent":return"Agent Operations";case"hook":return"Hook System";case"todo":return"Task Management";case"memory":return"Memory Operations";case"log":return"System Logs";case"connection":return"Connection Events";default:return"Other Events"}}createContextualHeader(t){const e=this.formatTimestamp(t.timestamp),n=t.data||{};let o="";switch(t.type){case"hook":const s=this.extractToolName(n),i=this.extractAgent(t)||"Unknown";if(s)o=`${s}: ${i} ${e}`;else{o=`${this.getHookDisplayName(t,n)}: ${i} ${e}`}break;case"agent":o=`Agent: ${n.agent_type||n.name||"Unknown"} ${e}`;break;case"todo":o=`TodoWrite: ${this.extractAgent(t)||"PM"} ${e}`;break;case"memory":o=`Memory: ${n.operation||"Unknown"} ${e}`;break;case"session":case"claude":case"log":case"connection":o=`Event: ${t.type}.${t.subtype||"default"} ${e}`;break;default:const a=this.extractFileName(n);if(a)o=`File: ${a} ${e}`;else{o=`Event: ${t.type||"Unknown"}.${t.subtype||"default"} ${e}`}}return`\n            <div class="contextual-header">\n                <h3 class="contextual-header-text">${o}</h3>\n            </div>\n        `}createEventStructuredView(t){const e=this.getEventClass(t),n=(this.eventsByClass.get(e)||[]).length;let o=`\n            <div class="structured-view-section">\n                ${this.createEventDetailCard(t.type,t,n)}\n            </div>\n        `;switch(t.type){case"agent":o+=this.createAgentStructuredView(t);break;case"hook":"Task"===t.data?.tool_name&&t.data?.tool_parameters?.subagent_type?o+=this.createAgentStructuredView(t):o+=this.createHookStructuredView(t);break;case"todo":o+=this.createTodoStructuredView(t);break;case"memory":o+=this.createMemoryStructuredView(t);break;case"claude":o+=this.createClaudeStructuredView(t);break;case"session":o+=this.createSessionStructuredView(t);break;default:o+=this.createGenericStructuredView(t)}return o}createEventDetailCard(t,e,n){const o=new Date(e.timestamp).toLocaleString();return`\n            <div class="event-detail-card">\n                <div class="event-detail-header">\n                    <div class="event-detail-title">\n                        ${this.getEventIcon(t)} ${t||"Unknown"}.${e.subtype||"default"}\n                    </div>\n                    <div class="event-detail-time">${o}</div>\n                </div>\n                <div class="event-detail-content">\n                    ${this.createProperty("Event ID",e.id||"N/A")}\n                    ${this.createProperty("Type",`${t}.${e.subtype||"default"}`)}\n                    ${this.createProperty("Class Events",n)}\n                    ${e.data&&e.data.session_id?this.createProperty("Session",e.data.session_id):""}\n                </div>\n            </div>\n        `}createAgentStructuredView(t){const e=t.data||{};if("hook"===t.type&&"Task"===e.tool_name&&e.tool_parameters?.subagent_type){const n=e.tool_parameters;return`\n                <div class="structured-view-section">\n                    <div class="structured-data">\n                        ${this.createProperty("Agent Type",n.subagent_type)}\n                        ${this.createProperty("Task Type","Subagent Delegation")}\n                        ${this.createProperty("Phase",t.subtype||"pre_tool")}\n                        ${n.description?this.createProperty("Description",n.description):""}\n                        ${n.prompt?this.createProperty("Prompt Preview",this.truncateText(n.prompt,200)):""}\n                        ${e.session_id?this.createProperty("Session ID",e.session_id):""}\n                        ${e.working_directory?this.createProperty("Working Directory",e.working_directory):""}\n                    </div>\n                    ${n.prompt?`\n                        <div class="prompt-section">\n                            <div class="contextual-header">\n                                <h3 class="contextual-header-text">üìù Task Prompt</h3>\n                            </div>\n                            <div class="structured-data">\n                                <div class="task-prompt" style="white-space: pre-wrap; max-height: 300px; overflow-y: auto; padding: 10px; background: #f8fafc; border-radius: 6px; font-family: monospace; font-size: 12px; line-height: 1.4;">\n                                    ${n.prompt}\n                                </div>\n                            </div>\n                        </div>\n                    `:""}\n                </div>\n            `}return`\n            <div class="structured-view-section">\n                <div class="structured-data">\n                    ${this.createProperty("Agent Type",e.agent_type||e.subagent_type||"Unknown")}\n                    ${this.createProperty("Name",e.name||"N/A")}\n                    ${this.createProperty("Phase",t.subtype||"N/A")}\n                    ${e.config?this.createProperty("Config","object"==typeof e.config?Object.keys(e.config).join(", "):String(e.config)):""}\n                    ${e.capabilities?this.createProperty("Capabilities",e.capabilities.join(", ")):""}\n                    ${e.result?this.createProperty("Result","object"==typeof e.result?"[Object]":String(e.result)):""}\n                </div>\n            </div>\n        `}createHookStructuredView(t){const e=t.data||{},n=this.extractFilePathFromHook(e),o=this.extractToolInfoFromHook(e),s=this.createInlineToolResultContent(e,t);return`\n            <div class="structured-view-section">\n                <div class="structured-data">\n                    ${this.createProperty("Hook Name",this.getHookDisplayName(t,e))}\n                    ${this.createProperty("Event Type",e.event_type||t.subtype||"N/A")}\n                    ${n?this.createProperty("File Path",n):""}\n                    ${o.tool_name?this.createProperty("Tool",o.tool_name):""}\n                    ${o.operation_type?this.createProperty("Operation",o.operation_type):""}\n                    ${e.session_id?this.createProperty("Session ID",e.session_id):""}\n                    ${e.working_directory?this.createProperty("Working Directory",e.working_directory):""}\n                    ${e.duration_ms?this.createProperty("Duration",`${e.duration_ms}ms`):""}\n                    ${s}\n                </div>\n            </div>\n        `}createInlineToolResultContent(t,e=null){const n=t.result_summary,o=e?.subtype||t.event_type||t.phase,s="post_tool"===o||o?.includes("post");if(window.DEBUG_TOOL_RESULTS&&console.log("üîß createInlineToolResultContent debug:",{hasResultSummary:!!n,eventPhase:o,isPostTool:s,eventSubtype:e?.subtype,dataEventType:t.event_type,dataPhase:t.phase,toolName:t.tool_name,resultSummaryKeys:n?Object.keys(n):[]}),!n)return"";if("pre_tool"===o||o?.includes("pre")&&!o?.includes("post"))return"";let i="";if(n.has_output&&n.output_preview&&(i+=`\n                ${this.createProperty("Output",this.truncateText(n.output_preview,200))}\n                ${n.output_lines?this.createProperty("Output Lines",n.output_lines):""}\n            `),n.has_error&&n.error_preview&&(i+=`\n                ${this.createProperty("Error",this.truncateText(n.error_preview,200))}\n            `),!n.has_output&&!n.has_error&&Object.keys(n).length>3){i+=Object.entries(n).filter(([t,e])=>!["has_output","has_error","exit_code"].includes(t)&&void 0!==e).map(([t,e])=>this.createProperty(this.formatFieldName(t),String(e))).join("")}return i}createToolResultSection(t,e=null){const n=t.result_summary,o=e?.subtype||t.event_type||t.phase,s="post_tool"===o||o?.includes("post");if(window.DEBUG_TOOL_RESULTS&&console.log("üîß createToolResultSection debug:",{hasResultSummary:!!n,eventPhase:o,isPostTool:s,eventSubtype:e?.subtype,dataEventType:t.event_type,dataPhase:t.phase,toolName:t.tool_name,resultSummaryKeys:n?Object.keys(n):[]}),!n)return"";if("pre_tool"===o||o?.includes("pre")&&!o?.includes("post"))return"";let i="‚è≥",a="tool-running",r="Unknown";!0===t.success?(i="‚úÖ",a="tool-success",r="Success"):!1===t.success?(i="‚ùå",a="tool-failure",r="Failed"):0===t.exit_code?(i="‚úÖ",a="tool-success",r="Completed"):2===t.exit_code?(i="‚ö†Ô∏è",a="tool-blocked",r="Blocked"):void 0!==t.exit_code&&0!==t.exit_code&&(i="‚ùå",a="tool-failure",r="Error");let l="";if(l+=`\n            <div class="tool-result-status ${a}">\n                <span class="tool-result-icon">${i}</span>\n                <span class="tool-result-text">${r}</span>\n                ${void 0!==t.exit_code?`<span class="tool-exit-code">Exit Code: ${t.exit_code}</span>`:""}\n            </div>\n        `,n.has_output&&n.output_preview&&(l+=`\n                <div class="tool-result-output">\n                    <div class="tool-result-label">üìÑ Output:</div>\n                    <div class="tool-result-preview">\n                        <pre>${this.escapeHtml(n.output_preview)}</pre>\n                    </div>\n                    ${n.output_lines?`<div class="tool-result-meta">Lines: ${n.output_lines}</div>`:""}\n                </div>\n            `),n.has_error&&n.error_preview&&(l+=`\n                <div class="tool-result-error">\n                    <div class="tool-result-label">‚ö†Ô∏è Error:</div>\n                    <div class="tool-result-preview error-preview">\n                        <pre>${this.escapeHtml(n.error_preview)}</pre>\n                    </div>\n                </div>\n            `),!n.has_output&&!n.has_error&&Object.keys(n).length>3){const t=Object.entries(n).filter(([t,e])=>!["has_output","has_error","exit_code"].includes(t)&&void 0!==e).map(([t,e])=>this.createProperty(this.formatFieldName(t),String(e))).join("");t&&(l+=`\n                    <div class="tool-result-other">\n                        <div class="tool-result-label">üìä Result Details:</div>\n                        <div class="structured-data">\n                            ${t}\n                        </div>\n                    </div>\n                `)}return l.trim()?`\n            <div class="tool-result-section">\n                <div class="contextual-header">\n                    <h3 class="contextual-header-text">üîß Tool Result</h3>\n                </div>\n                <div class="tool-result-content">\n                    ${l}\n                </div>\n            </div>\n        `:""}isWriteOperation(t,e){if(["Write","Edit","MultiEdit","NotebookEdit"].includes(t))return!0;if(e.tool_parameters){const t=e.tool_parameters;if(t.content||t.new_string||t.edits)return!0;if(t.edit_mode&&"read"!==t.edit_mode)return!0}return!("post_tool"!==e.event_type&&"pre_tool"!==e.event_type||!t||!(t.toLowerCase().includes("write")||t.toLowerCase().includes("edit")||t.toLowerCase().includes("modify")))}isReadOnlyOperation(t){if(!t)return!0;const e=t.toLowerCase();return!!["read"].includes(e)||!["write","edit","multiedit","create","delete","move","copy"].includes(e)}createTodoStructuredView(t){const e=t.data||{};let n="";return e.todos&&Array.isArray(e.todos)&&(n+=`\n                <div class="todo-checklist">\n                    ${e.todos.map(t=>`\n                        <div class="todo-item todo-${t.status||"pending"}">\n                            <span class="todo-status">${this.getTodoStatusIcon(t.status)}</span>\n                            <span class="todo-content">${t.content||"No content"}</span>\n                            <span class="todo-priority priority-${t.priority||"medium"}">${this.getTodoPriorityIcon(t.priority)}</span>\n                        </div>\n                    `).join("")}\n                </div>\n            `),n}createMemoryStructuredView(t){const e=t.data||{};return`\n            <div class="structured-view-section">\n                <div class="structured-data">\n                    ${this.createProperty("Operation",e.operation||"Unknown")}\n                    ${this.createProperty("Key",e.key||"N/A")}\n                    ${e.value?this.createProperty("Value","object"==typeof e.value?"[Object]":String(e.value)):""}\n                    ${e.namespace?this.createProperty("Namespace",e.namespace):""}\n                    ${e.metadata?this.createProperty("Metadata","object"==typeof e.metadata?"[Object]":String(e.metadata)):""}\n                </div>\n            </div>\n        `}createClaudeStructuredView(t){const e=t.data||{};return`\n            <div class="structured-view-section">\n                <div class="structured-data">\n                    ${this.createProperty("Type",t.subtype||"N/A")}\n                    ${e.prompt?this.createProperty("Prompt",this.truncateText(e.prompt,200)):""}\n                    ${e.message?this.createProperty("Message",this.truncateText(e.message,200)):""}\n                    ${e.response?this.createProperty("Response",this.truncateText(e.response,200)):""}\n                    ${e.content?this.createProperty("Content",this.truncateText(e.content,200)):""}\n                    ${e.tokens?this.createProperty("Tokens",e.tokens):""}\n                    ${e.model?this.createProperty("Model",e.model):""}\n                </div>\n            </div>\n        `}createSessionStructuredView(t){const e=t.data||{};return`\n            <div class="structured-view-section">\n                <div class="structured-data">\n                    ${this.createProperty("Action",t.subtype||"N/A")}\n                    ${this.createProperty("Session ID",e.session_id||"N/A")}\n                    ${e.working_directory?this.createProperty("Working Dir",e.working_directory):""}\n                    ${e.git_branch?this.createProperty("Git Branch",e.git_branch):""}\n                    ${e.agent_type?this.createProperty("Agent Type",e.agent_type):""}\n                </div>\n            </div>\n        `}createGenericStructuredView(t){const e=t.data||{},n=Object.keys(e);return 0===n.length?"":`\n            <div class="structured-view-section">\n                <div class="structured-data">\n                    ${n.map(t=>this.createProperty(t,"object"==typeof e[t]?"[Object]":String(e[t]))).join("")}\n                </div>\n            </div>\n        `}createCollapsibleJsonSection(t){const e="json-section-"+Math.random().toString(36).substr(2,9),n=this.formatJSON(t),o=this.globalJsonExpanded;return`\n            <div class="collapsible-json-section" id="${e}">\n                <div class="json-toggle-header"\n                     onclick="window.moduleViewer.toggleJsonSection()"\n                     role="button"\n                     tabindex="0"\n                     aria-expanded="${o?"true":"false"}"\n                     onkeydown="if(event.key==='Enter'||event.key===' '){window.moduleViewer.toggleJsonSection();event.preventDefault();}">\n                    <span class="json-toggle-text">Raw JSON</span>\n                    <span class="json-toggle-arrow">${o?"‚ñ≤":"‚ñº"}</span>\n                </div>\n                <div class="json-content-collapsible" style="display: ${o?"block":"none"};" aria-hidden="${!o}">\n                    <div class="json-display" onclick="window.moduleViewer.copyJsonToClipboard(event)">\n                        <pre>${n}</pre>\n                    </div>\n                </div>\n            </div>\n        `}async copyJsonToClipboard(t){const e=t.currentTarget.getBoundingClientRect(),n=t.clientX-e.left,o=t.clientY-e.top;if(n>e.width-50&&o<30){const e=t.currentTarget.querySelector("pre");if(e)try{await navigator.clipboard.writeText(e.textContent),this.showNotification("JSON copied to clipboard","success")}catch(s){console.error("Failed to copy JSON:",s),this.showNotification("Failed to copy JSON","error")}t.stopPropagation()}}initializeJsonToggle(){window.moduleViewer=this,this.globalJsonExpanded&&setTimeout(()=>{this.updateAllJsonSections()},0),this.keyboardListenerAdded||(this.keyboardListenerAdded=!0,document.addEventListener("keydown",t=>{t.target.classList.contains("json-toggle-header")&&("Enter"!==t.key&&" "!==t.key||(this.toggleJsonSection(),t.preventDefault()))}))}toggleJsonSection(){this.globalJsonExpanded=!this.globalJsonExpanded,localStorage.setItem("dashboard-json-expanded",this.globalJsonExpanded.toString()),this.updateAllJsonSections(),document.dispatchEvent(new CustomEvent("jsonToggleChanged",{detail:{expanded:this.globalJsonExpanded}}))}updateAllJsonSections(){const t=document.querySelectorAll(".json-content-collapsible"),e=document.querySelectorAll(".json-toggle-arrow"),n=document.querySelectorAll(".json-toggle-header");t.forEach((t,o)=>{this.globalJsonExpanded?(t.style.display="block",t.setAttribute("aria-hidden","false"),e[o]&&(e[o].textContent="‚ñ≤"),n[o]&&n[o].setAttribute("aria-expanded","true")):(t.style.display="none",t.setAttribute("aria-hidden","true"),e[o]&&(e[o].textContent="‚ñº"),n[o]&&n[o].setAttribute("aria-expanded","false"))}),this.globalJsonExpanded&&t.length>0&&setTimeout(()=>{const e=t[0];e&&e.scrollIntoView({behavior:"smooth",block:"nearest"})},100)}createProperty(t,e){const n=this.truncateText(String(e),300);return this.isFilePathProperty(t,e)?`\n                <div class="event-property">\n                    <span class="event-property-key">${t}:</span>\n                    <span class="event-property-value">\n                        ${this.createClickableFilePath(e)}\n                    </span>\n                </div>\n            `:`\n            <div class="event-property">\n                <span class="event-property-key">${t}:</span>\n                <span class="event-property-value">${n}</span>\n            </div>\n        `}isFilePathProperty(t,e){if(["File Path","file_path","notebook_path","Full Path","Working Directory","working_directory"].some(e=>t.toLowerCase().includes(e.toLowerCase()))){const t=String(e);return t.length>0&&(t.includes("/")||t.includes("\\"))&&t.length<500}return!1}createClickableFilePath(t){const e=this.truncateText(String(t),300);return`\n            <span class="clickable-file-path"\n                  onclick="showFileViewerModal('${t.replace(/'/g,"\\'")}')"\n                  title="Click to view file contents with syntax highlighting&#10;Path: ${t}">\n                ${e}\n            </span>\n        `}getEventIcon(t){const e={session:"üì±",claude:"ü§ñ",agent:"üéØ",hook:"üîó",todo:"‚úÖ",memory:"üß†",log:"üìù",connection:"üîå",unknown:"‚ùì"};return e[t]||e.unknown}getTodoStatusIcon(t){const e={completed:"‚úÖ",in_progress:"üîÑ",pending:"‚è≥",cancelled:"‚ùå"};return e[t]||e.pending}getTodoPriorityIcon(t){const e={high:"üî¥",medium:"üü°",low:"üü¢"};return e[t]||e.medium}getHookDisplayName(t,e){if(e.hook_name)return e.hook_name;if(e.name)return e.name;const n=t.subtype||e.event_type,o={user_prompt:"User Prompt",pre_tool:"Tool Execution (Pre)",post_tool:"Tool Execution (Post)",notification:"Notification",stop:"Session Stop",subagent_stop:"Subagent Stop"};if(o[n])return o[n];if("string"==typeof t.type&&t.type.startsWith("hook.")){const e=t.type.replace("hook.","");if(o[e])return o[e]}return n?n.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "):"Unknown Hook"}extractFilePathFromHook(t){return t.tool_parameters&&t.tool_parameters.file_path?t.tool_parameters.file_path:t.file_path?t.file_path:t.tool_input&&t.tool_input.file_path?t.tool_input.file_path:t.tool_parameters&&t.tool_parameters.notebook_path?t.tool_parameters.notebook_path:null}extractToolInfoFromHook(t){return{tool_name:t.tool_name||t.tool_parameters&&t.tool_parameters.tool_name,operation_type:t.operation_type||t.tool_parameters&&t.tool_parameters.operation_type}}truncateText(t,e){return!t||t.length<=e?t:t.substring(0,e)+"..."}formatJSON(t){try{return JSON.stringify(t,null,2)}catch(e){return String(t)}}formatTimestamp(t){if(!t)return"Unknown time";try{return new Date(t).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0})}catch(e){return"Invalid time"}}escapeHtml(t){if(!t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML}formatFieldName(t){return t.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}extractToolName(t){if(t.tool_name)return t.tool_name;if(t.tool_parameters&&t.tool_parameters.tool_name)return t.tool_parameters.tool_name;if(t.tool_input&&t.tool_input.tool_name)return t.tool_input.tool_name;if(t.tool_parameters){if(t.tool_parameters.file_path||t.tool_parameters.notebook_path)return"FileOperation";if(t.tool_parameters.pattern)return"Search";if(t.tool_parameters.command)return"Bash";if(t.tool_parameters.todos)return"TodoWrite"}return null}extractAgent(t){if(t._agentName&&"Unknown Agent"!==t._agentName)return t._agentName;if(t._inference&&t._inference.agentName&&"Unknown"!==t._inference.agentName)return t._inference.agentName;if(t.agent)return t.agent;if(t.agent_type)return t.agent_type;if(t.agent_name)return t.agent_name;if(t.session_id&&"string"==typeof t.session_id){const e=t.session_id.split("_");if(e.length>1)return e[0].toUpperCase()}return t.todos||"TodoWrite"===t.tool_name?"PM":null}extractFileName(t){const e=this.extractFilePathFromHook(t);if(e){const t=e.split("/");return t[t.length-1]}return t.filename?t.filename:t.file?t.file:null}clear(){this.showEmptyState()}showToolCall(t,e){if(!t)return void this.showEmptyState();const n=t.tool_name||"Unknown Tool",o=t.agent_type||"PM",s=this.formatTimestamp(t.timestamp),i=t.pre_event,a=t.post_event,r=i?.tool_parameters||{},l=i?this.extractToolTarget(n,r):"Unknown target",c=t.duration_ms?`${t.duration_ms}ms`:"-",d=void 0!==t.success?t.success:null;void 0!==t.exit_code&&t.exit_code;let p=t.result_summary||"No summary available";if("object"==typeof p&&null!==p){const t=[];void 0!==p.exit_code&&t.push(`Exit Code: ${p.exit_code}`),void 0!==p.has_output&&t.push("Has Output: "+(p.has_output?"Yes":"No")),void 0!==p.has_error&&t.push("Has Error: "+(p.has_error?"Yes":"No")),void 0!==p.output_lines&&t.push(`Output Lines: ${p.output_lines}`),p.output_preview&&t.push(`Output Preview: ${p.output_preview}`),p.error_preview&&t.push(`Error Preview: ${p.error_preview}`)}let u="‚è≥",h="Running...",m="tool-running";a&&(!0===d?(u="‚úÖ",h="Success",m="tool-success"):!1===d?(u="‚ùå",h="Failed",m="tool-failure"):(u="‚è≥",h="Completed",m="tool-completed"));const g=`\n            <div class="contextual-header">\n                <h3 class="contextual-header-text">${n}: ${o} ${s}</h3>\n            </div>\n        `;if("TodoWrite"===n&&r.todos){const e=`\n                <div class="todo-checklist">\n                    ${r.todos.map(t=>{const e=this.getTodoStatusIcon(t.status),n=this.getTodoPriorityIcon(t.priority);return`\n                            <div class="todo-item todo-${t.status||"pending"}">\n                                <span class="todo-status">${e}</span>\n                                <span class="todo-content">${t.content||"No content"}</span>\n                                <span class="todo-priority priority-${t.priority||"medium"}">${n}</span>\n                            </div>\n                        `}).join("")}\n                </div>\n            `,n={toolCall:t,preEvent:i,postEvent:a},o=this.createCollapsibleJsonSection(n);this.dataContainer&&(this.dataContainer.innerHTML=g+e+o),this.initializeJsonToggle()}else{const e=`\n                <div class="structured-view-section">\n                    <div class="tool-call-details">\n                        <div class="tool-call-info ${m}">\n                            <div class="structured-field">\n                                <strong>Tool Name:</strong> ${n}\n                            </div>\n                            <div class="structured-field">\n                                <strong>Agent:</strong> ${o}\n                            </div>\n                            <div class="structured-field">\n                                <strong>Status:</strong> ${u} ${h}\n                            </div>\n                            <div class="structured-field">\n                                <strong>Target:</strong> ${l}\n                            </div>\n                            <div class="structured-field">\n                                <strong>Started:</strong> ${new Date(t.timestamp).toLocaleString()}\n                            </div>\n                            ${c&&"-"!==c?`\n                                <div class="structured-field">\n                                    <strong>Duration:</strong> ${c}\n                                </div>\n                            `:""}\n                            ${t.session_id?`\n                                <div class="structured-field">\n                                    <strong>Session ID:</strong> ${t.session_id}\n                                </div>\n                            `:""}\n                        </div>\n\n                        ${this.createToolResultFromToolCall(t)}\n                    </div>\n                </div>\n            `,s={toolCall:t,preEvent:i,postEvent:a},r=this.createCollapsibleJsonSection(s);this.dataContainer&&(this.dataContainer.innerHTML=g+e+r),this.initializeJsonToggle()}}showFileOperations(t,e){if(!t||!e)return void this.showEmptyState();const n=e.split("/").pop()||e,o=t.operations||[],s=o[o.length-1],i=`\n            <div class="contextual-header">\n                <h3 class="contextual-header-text">File: ${n} ${s?this.formatTimestamp(s.timestamp):""}</h3>\n            </div>\n        `,a=`\n            <div class="structured-view-section">\n                <div class="file-details">\n                    <div class="file-path-display">\n                        <strong>Full Path:</strong> ${this.createClickableFilePath(e)}\n                        <div id="git-track-status-${e.replace(/[^a-zA-Z0-9]/g,"-")}" class="git-track-status" style="margin-top: 8px;">\n                            \x3c!-- Git tracking status will be populated here --\x3e\n                        </div>\n                    </div>\n                    <div class="operations-list">\n                        ${o.map(t=>`\n                            <div class="operation-item">\n                                <div class="operation-header">\n                                    <span class="operation-icon">${this.getOperationIcon(t.operation)}</span>\n                                    <span class="operation-type">${t.operation}</span>\n                                    <span class="operation-timestamp">${new Date(t.timestamp).toLocaleString()}</span>\n                                    ${this.isReadOnlyOperation(t.operation)?`\n                                        \x3c!-- Read-only operation: show only file viewer --\x3e\n                                        <span class="file-viewer-icon"\n                                              onclick="showFileViewerModal('${e}')"\n                                              title="View file contents with syntax highlighting"\n                                              style="margin-left: 8px; cursor: pointer; font-size: 16px;">\n                                            üëÅÔ∏è\n                                        </span>\n                                    `:`\n                                        \x3c!-- Edit operation: show both file viewer and git diff --\x3e\n                                        <span class="file-viewer-icon"\n                                              onclick="showFileViewerModal('${e}')"\n                                              title="View file contents with syntax highlighting"\n                                              style="margin-left: 8px; cursor: pointer; font-size: 16px;">\n                                            üëÅÔ∏è\n                                        </span>\n                                        <span class="git-diff-icon"\n                                              onclick="showGitDiffModal('${e}', '${t.timestamp}')"\n                                              title="View git diff for this file operation"\n                                              style="margin-left: 8px; cursor: pointer; font-size: 16px; display: none;"\n                                              data-file-path="${e}"\n                                              data-operation-timestamp="${t.timestamp}">\n                                            üìã\n                                        </span>\n                                    `}\n                                </div>\n                                <div class="operation-details">\n                                    <strong>Agent:</strong> ${t.agent}<br>\n                                    <strong>Session:</strong> ${t.sessionId?t.sessionId.substring(0,8)+"...":"Unknown"}\n                                    ${t.details?`<br><strong>Details:</strong> ${t.details}`:""}\n                                </div>\n                            </div>\n                        `).join("")}\n                    </div>\n                </div>\n            </div>\n        `;this.checkAndShowTrackControl(e),this.checkAndShowGitDiffIcons(e);const r=this.createCollapsibleJsonSection(t);this.dataContainer&&(this.dataContainer.innerHTML=i+a+r),this.initializeJsonToggle()}showErrorMessage(t,e){const n=`\n            <div class="module-error">\n                <div class="error-header">\n                    <h3>‚ùå ${t}</h3>\n                </div>\n                <div class="error-message">\n                    <p>${e}</p>\n                </div>\n            </div>\n        `,o={title:t,message:e},s=this.createCollapsibleJsonSection(o);this.dataContainer&&(this.dataContainer.innerHTML=n+s),this.initializeJsonToggle()}showAgentEvent(t,e){this.showAgentSpecificDetails(t,e)}showAgentSpecificDetails(t,e){if(!t)return void this.showEmptyState();const n=window.dashboard?.agentInference,o=window.dashboard?.eventViewer;if(!n||!o)return console.warn("AgentInference or EventViewer not available, falling back to single event view"),void this.showEventDetails(t);const s=n.getInferredAgentForEvent(t),i=s?.agentName||this.extractAgent(t)||"Unknown",a=o.events||[],r=this.getAgentSpecificEvents(a,i,n);console.log(`Showing details for agent: ${i}, found ${r.length} related events`);const l=this.extractAgentSpecificData(i,r);this.renderAgentSpecificView(i,l,t)}getAgentSpecificEvents(t,e,n){return t.filter(t=>{const o=n.getInferredAgentForEvent(t);return(o?.agentName||this.extractAgent(t)||"Unknown").toLowerCase()===e.toLowerCase()})}extractAgentSpecificData(t,e){const n={agentName:t,totalEvents:e.length,prompt:null,todos:[],toolsCalled:[],sessions:new Set,firstSeen:null,lastSeen:null,eventTypes:new Set};return e.forEach(e=>{const o=e.data||{},s=new Date(e.timestamp);(!n.firstSeen||s<n.firstSeen)&&(n.firstSeen=s),(!n.lastSeen||s>n.lastSeen)&&(n.lastSeen=s),(e.session_id||o.session_id)&&n.sessions.add(e.session_id||o.session_id);const i=e.hook_event_name||e.type||"unknown";if(n.eventTypes.add(i),"hook"===e.type&&"Task"===o.tool_name&&o.tool_parameters){const e=o.tool_parameters;e.prompt&&!n.prompt&&(n.prompt=e.prompt),e.description&&!n.description&&(n.description=e.description),e.subagent_type===t&&e.prompt&&(n.prompt=e.prompt)}if(!o.prompt||o.agent_type!==t&&o.subagent_type!==t||(n.prompt=o.prompt),"todo"===e.type||"hook"===e.type&&"TodoWrite"===o.tool_name){const t=o.todos||o.tool_parameters?.todos;t&&Array.isArray(t)&&t.forEach(t=>{const e=n.todos.findIndex(e=>e.id===t.id||e.content===t.content);e>=0?n.todos[e]={...n.todos[e],...t,timestamp:s}:n.todos.push({...t,timestamp:s})})}if("hook"===e.type&&o.tool_name){const t=e.subtype||o.event_type,i=this.generateToolCallId(o.tool_name,o.tool_parameters,s);"pre_tool"===t?(n._preToolEvents||(n._preToolEvents=new Map),n._preToolEvents.set(i,{toolName:o.tool_name,timestamp:s,target:this.extractToolTarget(o.tool_name,o.tool_parameters,null),parameters:o.tool_parameters})):"post_tool"===t&&(n._postToolEvents||(n._postToolEvents=new Map),n._postToolEvents.set(i,{toolName:o.tool_name,timestamp:s,success:o.success,duration:o.duration_ms,resultSummary:o.result_summary,exitCode:o.exit_code}))}}),n.todos.sort((t,e)=>(e.timestamp||0)-(t.timestamp||0)),n.toolsCalled=this.consolidateToolCalls(n._preToolEvents,n._postToolEvents),delete n._preToolEvents,delete n._postToolEvents,n.toolsCalled.sort((t,e)=>e.timestamp-t.timestamp),n}generateToolCallId(t,e,n){const o=Math.floor(n.getTime()/5e3);let s="";if(e){const t=[];e.file_path&&t.push(e.file_path),e.command&&t.push(e.command.substring(0,50)),e.pattern&&t.push(e.pattern),e.subagent_type&&t.push(e.subagent_type),e.notebook_path&&t.push(e.notebook_path),e.url&&t.push(e.url),e.prompt&&t.push(e.prompt.substring(0,30)),s=t.join("|")}return s||(s="default"),`${t}:${o}:${s}`}consolidateToolCalls(t,e){const n=[],o=new Set;t||(t=new Map),e||(e=new Map);for(const[s,i]of t){if(o.has(s))continue;const t=e.get(s),a={toolName:i.toolName,timestamp:i.timestamp,target:i.target,parameters:i.parameters,status:this.determineToolCallStatus(i,t),statusIcon:this.getToolCallStatusIcon(i,t),phase:t?"completed":"running"};t&&(a.success=t.success,a.duration=t.duration,a.resultSummary=t.resultSummary,a.exitCode=t.exitCode,a.completedAt=t.timestamp),n.push(a),o.add(s)}for(const[s,i]of e){if(o.has(s))continue;const t={toolName:i.toolName,timestamp:i.timestamp,target:"Unknown target",parameters:null,status:this.determineToolCallStatus(null,i),statusIcon:this.getToolCallStatusIcon(null,i),phase:"completed",success:i.success,duration:i.duration,resultSummary:i.resultSummary,exitCode:i.exitCode,completedAt:i.timestamp};n.push(t),o.add(s)}return n}determineToolCallStatus(t,e){return e?!0===e.success?"Success":!1===e.success?"Failed":0===e.exitCode?"Completed":2===e.exitCode?"Blocked":void 0!==e.exitCode&&0!==e.exitCode?"Error":"Completed":"Running..."}getToolCallStatusIcon(t,e){return e?!0===e.success?"‚úÖ":!1===e.success?"‚ùå":0===e.exitCode?"‚úÖ":2===e.exitCode?"‚ö†Ô∏è":void 0!==e.exitCode&&0!==e.exitCode?"‚ùå":"‚úÖ":"‚è≥"}estimateTokenCount(t){if(!t||"string"!=typeof t)return 0;const e=t.trim().split(/\s+/).length,n=Math.ceil(t.length/4);return Math.max(1.3*e,n)}trimPromptWhitespace(t){return t&&"string"==typeof t?t=(t=(t=t.trim()).replace(/\n\s*\n\s*\n+/g,"\n\n")).split("\n").map(t=>t.replace(/\s+$/,"")).join("\n"):""}renderAgentSpecificView(t,e,n){const o=this.formatTimestamp(n.timestamp),s=`\n            <div class="contextual-header">\n                <h3 class="contextual-header-text">ü§ñ ${t} Agent Details ${o}</h3>\n            </div>\n        `;let i=`\n            <div class="agent-overview-section">\n                <div class="structured-data">\n                    ${this.createProperty("Agent Name",t)}\n                    ${this.createProperty("Total Events",e.totalEvents)}\n                    ${this.createProperty("Active Sessions",e.sessions.size)}\n                    ${this.createProperty("Event Types",Array.from(e.eventTypes).join(", "))}\n                    ${e.firstSeen?this.createProperty("First Seen",e.firstSeen.toLocaleString()):""}\n                    ${e.lastSeen?this.createProperty("Last Seen",e.lastSeen.toLocaleString()):""}\n                </div>\n            </div>\n        `;if(e.prompt){const t=this.trimPromptWhitespace(e.prompt);i+=`\n                <div class="agent-prompt-section">\n                    <div class="contextual-header">\n                        <h3 class="contextual-header-text">üìù Agent Task Prompt</h3>\n                        <div class="prompt-stats" style="font-size: 11px; color: #64748b; margin-top: 4px;">\n                            ~${Math.round(this.estimateTokenCount(t))} tokens ‚Ä¢ ${t.trim().split(/\s+/).length} words ‚Ä¢ ${t.length} characters\n                        </div>\n                    </div>\n                    <div class="structured-data">\n                        <div class="agent-prompt" style="white-space: pre-wrap; max-height: 300px; overflow-y: auto; padding: 10px; background: #f8fafc; border-radius: 6px; font-family: monospace; font-size: 12px; line-height: 1.4; border: 1px solid #e2e8f0;">\n                            ${this.escapeHtml(t)}\n                        </div>\n                    </div>\n                </div>\n            `}e.todos.length>0&&(i+=`\n                <div class="agent-todos-section">\n                    <div class="contextual-header">\n                        <h3 class="contextual-header-text">‚úÖ Agent Todo List (${e.todos.length} items)</h3>\n                    </div>\n                    <div class="todo-checklist">\n                        ${e.todos.map(t=>`\n                            <div class="todo-item todo-${t.status||"pending"}">\n                                <span class="todo-status">${this.getTodoStatusIcon(t.status)}</span>\n                                <span class="todo-content">${t.content||"No content"}</span>\n                                <span class="todo-priority priority-${t.priority||"medium"}">${this.getTodoPriorityIcon(t.priority)}</span>\n                                ${t.timestamp?`<span class="todo-timestamp">${new Date(t.timestamp).toLocaleTimeString()}</span>`:""}\n                            </div>\n                        `).join("")}\n                    </div>\n                </div>\n            `),e.toolsCalled.length>0&&(i+=`\n                <div class="agent-tools-section">\n                    <div class="contextual-header">\n                        <h3 class="contextual-header-text">üîß Tools Called by Agent (${e.toolsCalled.length} calls)</h3>\n                    </div>\n                    <div class="tools-list">\n                        ${e.toolsCalled.map(e=>{let n="";return"‚úÖ"===e.statusIcon?n="status-success":"‚ùå"===e.statusIcon?n="status-failed":"‚ö†Ô∏è"===e.statusIcon?n="status-blocked":"‚è≥"===e.statusIcon&&(n="status-running"),`\n                                <div class="tool-call-item">\n                                    <div class="tool-call-header">\n                                        <div style="display: flex; align-items: center; gap: 12px; flex: 1;">\n                                            <span class="tool-name">üîß ${e.toolName}</span>\n                                            <span class="tool-agent">${t}</span>\n                                            <span class="tool-status-indicator ${n}">${e.statusIcon} ${e.status}</span>\n                                        </div>\n                                        <span class="tool-timestamp" style="margin-left: auto;">${e.timestamp.toLocaleTimeString()}</span>\n                                    </div>\n                                    <div class="tool-call-details">\n                                        ${e.target?`<span class="tool-target">Target: ${e.target}</span>`:""}\n                                        ${e.duration?`<span class="tool-duration">Duration: ${e.duration}ms</span>`:""}\n                                        ${e.completedAt&&e.completedAt!==e.timestamp?`<span class="tool-completed">Completed: ${e.completedAt.toLocaleTimeString()}</span>`:""}\n                                    </div>\n                                </div>\n                            `}).join("")}\n                    </div>\n                </div>\n            `);const a={agentName:t,agentData:e,originalEvent:n},r=this.createCollapsibleJsonSection(a);this.dataContainer&&(this.dataContainer.innerHTML=s+i+r),this.initializeJsonToggle()}createToolResultFromToolCall(t){if(!t.result_summary)return"";const e={event_type:"post_tool",result_summary:t.result_summary,success:t.success,exit_code:t.exit_code},n=this.createInlineToolResultContent(e,{subtype:"post_tool"});return n.trim()?`\n                <div class="tool-result-inline">\n                    <div class="structured-data">\n                        ${n}\n                    </div>\n                </div>\n            `:""}extractToolTarget(t,e,n){const o=e||n||{};switch(t?.toLowerCase()){case"write":case"read":case"edit":case"multiedit":return o.file_path||"Unknown file";case"bash":return o.command?`${o.command.substring(0,50)}${o.command.length>50?"...":""}`:"Unknown command";case"grep":return o.pattern?`Pattern: ${o.pattern}`:"Unknown pattern";case"glob":return o.pattern?`Pattern: ${o.pattern}`:"Unknown glob";case"todowrite":return`${o.todos?.length||0} todos`;case"task":return o.subagent_type||o.agent_type||"Subagent delegation";default:return o.file_path?o.file_path:o.pattern?`Pattern: ${o.pattern}`:o.command?`Command: ${o.command.substring(0,30)}...`:o.path?o.path:"Unknown target"}}getOperationIcon(t){return{read:"üëÅÔ∏è",write:"‚úèÔ∏è",edit:"üìù",multiedit:"üìù",create:"üÜï",delete:"üóëÔ∏è",move:"üì¶",copy:"üìã"}[t?.toLowerCase()]||"üìÑ"}getCurrentEvent(){return this.currentEvent}async checkAndShowTrackControl(t){if(t)try{const e=window.socket||window.dashboard?.socketClient?.socket;if(!e)return void console.warn("No socket connection available for git tracking check");let n=window.dashboard?.currentWorkingDir;if(!n||"Unknown"===n||""===n.trim()){const t=document.getElementById("footer-working-dir");n=t?.textContent?.trim()&&"Unknown"!==t.textContent.trim()?t.textContent.trim():".",console.log("[MODULE-VIEWER-DEBUG] Working directory fallback used:",n)}const o=new Promise((n,o)=>{const s=o=>{o.file_path===t&&(e.off("file_tracked_response",s),n(o))};e.on("file_tracked_response",s),setTimeout(()=>{e.off("file_tracked_response",s),o(new Error("Request timeout"))},5e3)});e.emit("check_file_tracked",{file_path:t,working_dir:n});const s=await o;this.displayTrackingStatus(t,s)}catch(e){console.error("Error checking file tracking status:",e),this.displayTrackingStatus(t,{success:!1,error:e.message,file_path:t})}}displayTrackingStatus(t,e){const n=`git-track-status-${t.replace(/[^a-zA-Z0-9]/g,"-")}`,o=document.getElementById(n);o&&(e.success&&!1===e.is_tracked?o.innerHTML=`\n                <div class="untracked-file-notice">\n                    <span class="untracked-icon">‚ö†Ô∏è</span>\n                    <span class="untracked-text">This file is not tracked by git</span>\n                    <button class="track-file-button"\n                            onclick="window.moduleViewer.trackFile('${t}')"\n                            title="Add this file to git tracking">\n                        <span class="git-icon">üìÅ</span> Track File\n                    </button>\n                </div>\n            `:e.success&&!0===e.is_tracked?o.innerHTML='\n                <div class="tracked-file-notice">\n                    <span class="tracked-icon">‚úÖ</span>\n                    <span class="tracked-text">This file is tracked by git</span>\n                </div>\n            ':e.success||(o.innerHTML=`\n                <div class="tracking-error-notice">\n                    <span class="error-icon">‚ùå</span>\n                    <span class="error-text">Could not check git status: ${e.error||"Unknown error"}</span>\n                </div>\n            `))}async trackFile(t){if(t)try{const e=window.socket||window.dashboard?.socketClient?.socket;if(!e)return void console.warn("No socket connection available for git add");let n=window.dashboard?.currentWorkingDir;if(!n||"Unknown"===n||""===n.trim()){const t=document.getElementById("footer-working-dir");n=t?.textContent?.trim()&&"Unknown"!==t.textContent.trim()?t.textContent.trim():".",console.log("[MODULE-VIEWER-DEBUG] Working directory fallback used:",n)}const o=`git-track-status-${t.replace(/[^a-zA-Z0-9]/g,"-")}`,s=document.getElementById(o);s&&(s.innerHTML='\n                    <div class="tracking-file-notice">\n                        <span class="loading-icon">‚è≥</span>\n                        <span class="loading-text">Adding file to git tracking...</span>\n                    </div>\n                ');const i=new Promise((n,o)=>{const s=o=>{o.file_path===t&&(e.off("git_add_response",s),n(o))};e.on("git_add_response",s),setTimeout(()=>{e.off("git_add_response",s),o(new Error("Request timeout"))},1e4)});e.emit("git_add_file",{file_path:t,working_dir:n}),console.log("üìÅ Git add request sent:",{filePath:t,workingDir:n});const a=await i;console.log("üì¶ Git add result:",a),a.success?(s&&(s.innerHTML='\n                        <div class="tracked-file-notice">\n                            <span class="tracked-icon">‚úÖ</span>\n                            <span class="tracked-text">File successfully added to git tracking</span>\n                        </div>\n                    '),this.showNotification("File tracked successfully","success")):(s&&(s.innerHTML=`\n                        <div class="tracking-error-notice">\n                            <span class="error-icon">‚ùå</span>\n                            <span class="error-text">Failed to track file: ${a.error||"Unknown error"}</span>\n                            <button class="track-file-button"\n                                    onclick="window.moduleViewer.trackFile('${t}')"\n                                    title="Try again">\n                                <span class="git-icon">üìÅ</span> Retry\n                            </button>\n                        </div>\n                    `),this.showNotification(`Failed to track file: ${a.error}`,"error"))}catch(e){console.error("‚ùå Failed to track file:",e);const n=`git-track-status-${t.replace(/[^a-zA-Z0-9]/g,"-")}`,o=document.getElementById(n);o&&(o.innerHTML=`\n                    <div class="tracking-error-notice">\n                        <span class="error-icon">‚ùå</span>\n                        <span class="error-text">Error: ${e.message}</span>\n                        <button class="track-file-button"\n                                onclick="window.moduleViewer.trackFile('${t}')"\n                                title="Try again">\n                            <span class="git-icon">üìÅ</span> Retry\n                        </button>\n                    </div>\n                `),this.showNotification(`Error tracking file: ${e.message}`,"error")}}async checkAndShowGitDiffIcons(t){if(t){console.debug("[GIT-DIFF-ICONS] Checking git diff icons for file:",t);try{const e=window.socket||window.dashboard?.socketClient?.socket;if(!e)return void console.warn("[GIT-DIFF-ICONS] No socket connection available for git status check");console.debug("[GIT-DIFF-ICONS] Socket connection available, proceeding");let n=window.dashboard?.currentWorkingDir;if(n&&"Unknown"!==n&&""!==n.trim())console.debug("[GIT-DIFF-ICONS] Using working directory:",n);else{const t=document.getElementById("footer-working-dir");n=t?.textContent?.trim()&&"Unknown"!==t.textContent.trim()?t.textContent.trim():".",console.log("[GIT-DIFF-ICONS] Working directory fallback used:",n)}const o=new Promise((n,o)=>{const s=o=>{console.debug("[GIT-DIFF-ICONS] Received git status response:",o),o.file_path===t?(e.off("git_status_response",s),n(o)):console.debug("[GIT-DIFF-ICONS] Response for different file, ignoring:",o.file_path)};e.on("git_status_response",s),setTimeout(()=>{e.off("git_status_response",s),console.warn("[GIT-DIFF-ICONS] Timeout waiting for git status response"),o(new Error("Request timeout"))},3e3)});console.debug("[GIT-DIFF-ICONS] Sending check_git_status event"),e.emit("check_git_status",{file_path:t,working_dir:n});const s=await o;console.debug("[GIT-DIFF-ICONS] Git status check result:",s),s.success?(console.debug("[GIT-DIFF-ICONS] Git status check successful, showing icons for:",t),this.showGitDiffIconsForFile(t)):console.debug("[GIT-DIFF-ICONS] Git status check failed, icons will remain hidden:",s.error)}catch(e){console.warn("[GIT-DIFF-ICONS] Git status check failed, hiding git diff icons:",e.message)}}else console.debug("[GIT-DIFF-ICONS] No filePath provided, skipping git diff icon check")}showGitDiffIconsForFile(t){console.debug("[GIT-DIFF-ICONS] Showing git diff icons for file:",t);const e=document.querySelectorAll(`[data-file-path="${t}"]`);console.debug("[GIT-DIFF-ICONS] Found",e.length,"elements with matching file path");let n=0;e.forEach((t,e)=>{console.debug("[GIT-DIFF-ICONS] Processing element",e,":",t),console.debug("[GIT-DIFF-ICONS] Element classes:",t.classList.toString()),t.classList.contains("git-diff-icon")?(console.debug("[GIT-DIFF-ICONS] Setting display to inline for git-diff-icon"),t.style.display="inline",n++):console.debug("[GIT-DIFF-ICONS] Element is not a git-diff-icon, skipping")}),console.debug("[GIT-DIFF-ICONS] Showed",n,"git diff icons for file:",t)}showNotification(t,e="info"){const n=document.createElement("div");n.className=`notification notification-${e}`,n.innerHTML=`\n            <span class="notification-icon">${"success"===e?"‚úÖ":"error"===e?"‚ùå":"‚ÑπÔ∏è"}</span>\n            <span class="notification-message">${t}</span>\n        `,n.style.cssText=`\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: ${"success"===e?"#d4edda":"error"===e?"#f8d7da":"#d1ecf1"};\n            color: ${"success"===e?"#155724":"error"===e?"#721c24":"#0c5460"};\n            border: 1px solid ${"success"===e?"#c3e6cb":"error"===e?"#f5c6cb":"#bee5eb"};\n            border-radius: 6px;\n            padding: 12px 16px;\n            font-size: 14px;\n            font-weight: 500;\n            z-index: 2000;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            max-width: 400px;\n            animation: slideIn 0.3s ease-out;\n        `;const o=document.createElement("style");o.textContent="\n            @keyframes slideIn {\n                from { transform: translateX(100%); opacity: 0; }\n                to { transform: translateX(0); opacity: 1; }\n            }\n            @keyframes slideOut {\n                from { transform: translateX(0); opacity: 1; }\n                to { transform: translateX(100%); opacity: 0; }\n            }\n        ",document.head.appendChild(o),document.body.appendChild(n),setTimeout(()=>{n.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),o.parentNode&&o.parentNode.removeChild(o)},300)},5e3)}showAgentInstance(t){if(!t)return void this.showEmptyState();const e={type:"pm_delegation",subtype:t.agentName,agent_type:t.agentName,timestamp:t.timestamp,session_id:t.sessionId,metadata:{delegation_type:"explicit",event_count:t.agentEvents.length,pm_call:t.pmCall||null,agent_events:t.agentEvents}};console.log("Showing PM delegation details:",t),this.showAgentSpecificDetails(e,0)}showImpliedAgent(t){if(!t)return void this.showEmptyState();const e={type:"implied_delegation",subtype:t.agentName,agent_type:t.agentName,timestamp:t.timestamp,session_id:t.sessionId,metadata:{delegation_type:"implied",event_count:t.eventCount,pm_call:null,note:"No explicit PM call found - inferred from agent activity"}};console.log("Showing implied agent details:",t),this.showAgentSpecificDetails(e,0)}}window.ModuleViewer=t,window.enableToolResultDebugging=function(){window.DEBUG_TOOL_RESULTS=!0,console.log("üîß Tool result debugging enabled. Click on tool events to see debug info.")},window.disableToolResultDebugging=function(){window.DEBUG_TOOL_RESULTS=!1,console.log("üîß Tool result debugging disabled.")};export{t as M};
//# sourceMappingURL=module-viewer.js.map
